# DDoSer — Bash-скрипт для анализа и реагирования на DDoS

## Описание

**DDoSer** — это мощный интерактивный bash-скрипт для администраторов Linux-серверов, который помогает обнаруживать и частично автоматически реагировать на DDoS-атаки. Скрипт анализирует логи веб-серверов и сетевые соединения, выявляет подозрительные IP, автоматически блокирует их и сохраняет отчёты. Поддерживает работу с популярными панелями управления хостингом и мультихостингом.

---

## Быстрый запуск одной командой

```bash
# Самый быстрый способ - запуск напрямую
bash <(curl -s https://raw.githubusercontent.com/spoveddd/scripts/main/linux/ddoser/ddoser.sh)

# Альтернативный способ
curl -s https://raw.githubusercontent.com/spoveddd/scripts/main/linux/ddoser/ddoser.sh | bash
```

---

## Локальный запуск

1. **Скачайте скрипт:**
    ```bash
    wget https://raw.githubusercontent.com/spoveddd/scripts/main/linux/ddoser/ddoser.sh
    ```
2. **Сделайте его исполняемым:**
    ```bash
    chmod +x ddoser.sh
    ```
3. **Запустите:**
    ```bash
    ./ddoser.sh
    ```

---

## Основной функционал

- **Автоматическое определение ОС и панели управления** (ISPmanager, FastPanel, Hestia, Vesta, DirectAdmin, cPanel, Nginx, Apache)
- **Анализ access-логов**:
  - Топ IP по количеству запросов
  - Топ URI (запрашиваемые страницы)
  - Топ User-Agent
  - Подозрительные IP (выделяются по порогу запросов)
- **Анализ сетевых соединений** (netstat, ss):
  - Топ IP по количеству соединений
- **Мониторинг в реальном времени**:
  - Выберите время мониторинга (по умолчанию 30 секунд)
  - В течение выбранного времени скрипт анализирует новые записи в логах и выводит топ IP/URI за этот период
- **Автоматическая блокировка IP** через iptables
- **Блокировка User-Agent** через nginx конфигурации для FastPanel, ISPmanager и Hestia
- **Сохранение подробных отчётов** в /var/log/ddoser_script.log
- **Красивый цветной вывод и удобное меню**
- **Показ нагрузки на сервер** (uptime, топ процессов по CPU и памяти)
- **Показ ссылки для входа в панель управления** (если возможно)

---

## Пример меню

```
==============================
 DDoSer: Анализ подозрительной активности
 ОС: Ubuntu 24.04
 Панель: fastpanel
==============================
Ссылка для входа в панель: https://159.253.18.203:8888/
Топ IP по логам за сегодня:
    372 176.60.70.103
      2 185.4.72.146

Выберите действие:
1. Заблокировать IP
2. Заблокировать UA (FASTPANEL/ISPmanager/Hestia)
3. Сохранить отчёт
4. Показать ссылку на панель
5. Мониторинг в реальном времени
6. Повторный анализ
0. Выход
```

---

## Новые функции

### Автоматическая блокировка IP
При выборе пункта "1. Заблокировать IP" скрипт автоматически показывает топ IP из логов с нумерацией и предлагает выбрать IP для блокировки. После выбора IP автоматически блокируются через iptables.

### Блокировка User-Agent (для FastPanel, ISPmanager и Hestia)
При выборе пункта "2. Заблокировать UA (FASTPANEL/ISPmanager/Hestia)" скрипт показывает топ User-Agent из логов и предлагает выбрать один или несколько User-Agent для блокировки.

#### Для FastPanel и ISPmanager:
Скрипт создает соответствующий конфигурационный файл nginx:
- **FastPanel**: /etc/nginx/fastpanel2-includes/blockua.conf
- **ISPmanager**: /etc/nginx/vhosts-includes/blockua.conf

Если файл конфигурации уже существует, новые правила добавляются в конец файла без перезаписи.

#### Для Hestia:
Скрипт находит все файлы `/home/*/nginx.ssl.conf` и создает для каждого соответствующий файл `nginx.ssl.conf_badbot` с правилами блокировки. Если файл `_badbot` уже существует, новые правила добавляются в него.

После создания конфигурации автоматически проверяется синтаксис nginx и выполняется перезагрузка сервиса.

---

## Требования
- bash
- netstat, ss, awk, grep, sort, uniq, tail
- iptables
- nginx
- Права root для блокировки IP и User-Agent

---

## Репозиторий
[https://github.com/spoveddd/scripts/tree/main/linux/ddoser](https://github.com/spoveddd/scripts/tree/main/linux/ddoser)

---

**DDoSer** — ваш быстрый помощник для анализа и реагирования на DDoS прямо с консоли!